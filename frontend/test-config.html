<!DOCTYPE html>
<html>
<head>
    <title>Config Test</title>
</head>
<body>
    <h1>API Config Test</h1>
    <div id="results"></div>
    
    <script type="module">
        // Simulate Vite environment
        window.__vite_plugin_react_preamble_installed__ = true;
        
        // Mock import.meta.env
        if (!window.import) {
            window.import = {
                meta: {
                    env: {
                        VITE_API_BASE_URL: 'https://api.newroadai.com',
                        VITE_API_URL: 'https://api.newroadai.com/api/v1',
                        DEV: false
                    }
                }
            };
        }

        // Copy the config logic
        const getApiUrl = () => {
          if (typeof window === 'undefined') {
            return 'https://api.newroadai.com';
          }

          const hostname = window.location.hostname;
          const protocol = window.location.protocol;
          
          const isProductionHostname = hostname.includes('newroadai.com') || 
                                        hostname.includes('pages.dev') ||
                                        hostname.includes('cloudflare');
          const isHttps = protocol === 'https:';
          const isProduction = isHttps || isProductionHostname;
          
          console.log('[config] API URL detection:', {
            hostname,
            protocol,
            isProduction,
            isProductionHostname,
            isHttps,
            'window.location.href': window.location.href
          });
          
          if (isProduction) {
            console.log('[config] Production detected, using HTTPS');
            return 'https://api.newroadai.com';
          }
          
          console.log('[config] Development detected, checking env vars');
          const envUrl = window.import.meta.env.VITE_API_BASE_URL;
          if (envUrl) {
            if (envUrl.includes('newroadai.com') && envUrl.startsWith('http://')) {
              console.log('[config] Converting env HTTP to HTTPS');
              return envUrl.replace('http://', 'https://');
            }
            console.log('[config] Using env URL:', envUrl);
            return envUrl.endsWith('/') ? envUrl.slice(0, -1) : envUrl;
          }
          
          console.log('[config] Fallback to localhost');
          return 'http://localhost:8000';
        };

        const getApiBaseUrl = () => {
          return getApiUrl();
        };

        const getApiV1Url = () => {
          return `${getApiUrl()}/api/v1`;
        };

        // Test the functions
        const baseUrl = getApiBaseUrl();
        const v1Url = getApiV1Url();
        
        document.getElementById('results').innerHTML = `
            <p><strong>Base URL:</strong> ${baseUrl}</p>
            <p><strong>V1 URL:</strong> ${v1Url}</p>
            <p><strong>Protocol should be HTTPS:</strong> ${baseUrl.startsWith('https://') ? '✅' : '❌'}</p>
        `;
    </script>
</body>
</html>